FROM mingc/android-build-box:latest as build

ARG GOOGLE_CLIENTID
ARG GITHUB_CLIENTID
ARG SPOTIFY_CLIENTID
ARG DISCORD_CLIENTID
ARG TWITCH_CLIENTID
ARG TWITCH_REDIRECT

ENV GOOGLE_CLIENTID $GOOGLE_CLIENTID
ENV GITHUB_CLIENTID $GITHUB_CLIENTID
ENV SPOTIFY_CLIENTID $SPOTIFY_CLIENTID
ENV DISCORD_CLIENTID $DISCORD_CLIENTID
ENV TWITCH_CLIENTID $TWITCH_CLIENTID
ENV TWITCH_REDIRECT $TWITCH_REDIRECT

#Installing app
WORKDIR /app
COPY ["HookHook.Mobile", "/app"]

RUN flutter pub get
RUN flutter build apk  --dart-define GITHUB_CLIENTID=$GITHUB_CLIENTID  --dart-define SPOTIFY_CLIENTID=$SPOTIFY_CLIENTID --dart-define DISCORD_CLIENTID=$DISCORD_CLIENTID --dart-define TWITCH_CLIENTID=$TWITCH_CLIENTID  --dart-define TWITCH_REDIRECT=$TWITCH_REDIRECT  --dart-define GOOGLE_CLIENTID=$GOOGLE_CLIENTID

FROM alpine as app
WORKDIR /build

COPY --from=build /app/build/app/outputs/flutter-apk/app-release.apk /build/client.apk