FROM node:lts-alpine as build
WORKDIR /app

ARG VUE_APP_DISCORD_CLIENTID
ARG VUE_APP_DISCORD_REDIRECT
ARG VUE_APP_GITHUB_CLIENTID
ARG VUE_APP_SPOTIFY_CLIENTID
ARG VUE_APP_SPOTIFY_REDIRECT
ARG VUE_APP_TWITCH_CLIENTID
ARG VUE_APP_TWITCH_REDIRECT
ARG VUE_APP_TWITTER_CLIENTID
ARG VUE_APP_TWITTER_REDIRECT
ARG VUE_APP_GOOGLE_CLIENTID

ENV VUE_APP_DISCORD_CLIENTID $VUE_APP_DISCORD_CLIENTID
ENV VUE_APP_DISCORD_REDIRECT $VUE_APP_DISCORD_REDIRECT
ENV VUE_APP_GITHUB_CLIENTID $VUE_APP_GITHUB_CLIENTID
ENV VUE_APP_SPOTIFY_CLIENTID $VUE_APP_SPOTIFY_CLIENTID
ENV VUE_APP_SPOTIFY_REDIRECT $VUE_APP_SPOTIFY_REDIRECT
ENV VUE_APP_TWITCH_CLIENTID $VUE_APP_TWITCH_CLIENTID
ENV VUE_APP_TWITCH_REDIRECT $VUE_APP_TWITCH_REDIRECT
ENV VUE_APP_TWITTER_CLIENTID $VUE_APP_TWITTER_CLIENTID
ENV VUE_APP_TWITTER_REDIRECT $VUE_APP_TWITTER_REDIRECT
ENV VUE_APP_GOOGLE_CLIENTID $VUE_APP_GOOGLE_CLIENTID

COPY HookHook.Web/package*.json /app/
RUN npm install

COPY HookHook.Web/ /app
RUN npm run build

FROM nginx as production
EXPOSE 80

RUN mkdir /app

COPY --from=build /app/dist /app
COPY HookHook.Web/nginx.conf /etc/nginx/templates/default.conf.template
